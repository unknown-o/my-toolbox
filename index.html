<style>
    .my_toolbox-table table tbody tr td span {
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        width: 580px;
        display: block;
    }

    .plugin_about {
        padding: 15px 30px;
        line-height: 26px;
        background: #f0f0f1;
        border-radius: 5px;
        border: 1px solid #ffffff;
    }
</style>
<div class="bt-form">
    <div id="pluginMain" class="bt-w-main">
        <div class="bt-w-menu">
            <p>端口扫描</p>
            <p>Hosts编辑</p>
            <p>软链接操作</p>
            <p>命令执行</p>
            <p>日志写入</p>
            <p>网站压力测试</p>
            <p>请求网页</p>
            <p>短链接生成</p>
            <p>网站地图生成</p>
            <p>关于本插件</p>
        </div>
        <div class="bt-w-con pd15">
            <div class="plugin_body">
                <div id="scanPort" style="display: none;">
                    <div id="scanPortForm">
                        <H3>端口扫描</H3><br>
                        <div class='soft-man-con bt-form'><br>
                            <div class='line'><span class='tname'>目标IP</span>
                                <div class='info-r'>
                                    <input id='serverIp' placeholder='127.0.0.1' type='text' class='bt-input-text mr5'
                                        value='' style='width: 430px;'>
                                    <br />
                                    <span style='color: rgb(153, 153, 153);'>输入需要扫描开放端口的服务器IP</span>
                                </div>
                            </div>
                            <div class='line'><span class='tname'>扫描范围</span>
                                <div class='info-r'>
                                    <input id='portStart' placeholder='1' type='number' class='bt-input-text mr5'
                                        style='width: 100px;'> - &nbsp;
                                    <input id='portEnd' placeholder='65535' type='number' class='bt-input-text mr5'
                                        style='width: 100px;'>
                                    <br />
                                    <span style='color: rgb(153, 153, 153);'>扫描端口范围，范围越小耗时越少</span>
                                </div>
                            </div>
                            <div class='line'>
                                <span class='tname'></span>
                                <br>
                                <div class='info-r'>
                                    <button class='btn btn-success btn-sm' id="startScanBTN"
                                        onclick='startScan()'>开始扫描</button>
                                </div>
                            </div><br><br><br><br><br><br><br><br><br><br>
                            <ul class='help-info-text c7 mtb15'>
                                <li>崩坏原神，淦翻内存！</li>
                                <li>PS：建议扫描1-1024端口，因为大部分常用端口集中在此范围</li>
                                <li>本功能基于nmap，如果未安装此软件包或系统不支持此命令，本功能将无法使用</li>
                                <li>扫描时间随需扫描端口数量的增多而变长。所以扫描端口数较多时，请耐心等待！</li>
                            </ul>
                        </div>
                    </div>
                    <div id="portScanResultTable" style="display: none;">
                        <H3>端口扫描
                            <button class='btn btn-default btn-sm btn-success' onclick='backToScan()'>返回上一页</button>
                        </H3><br>
                        <div style="max-height:402px;overflow:auto;border:#ddd 1px solid;">
                            <div class="divtable">
                                <table class="table table-hover">
                                    <thead>
                                        <tr>
                                            <th>端口</th>
                                            <th>当前状态</th>
                                            <th>服务类型（仅参考）</th>
                                        </tr>
                                    </thead>
                                    <tbody id="portFormBody">
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <ul class='help-info-text c7 mtb15'>
                            <li>派蒙 —— 最好的应急食品</li>
                            <li>我叫可莉，是个僵尸，会做牛杂，喜欢占星，目前是西风骑士团的代理团长，经营着一家酒庄</li>
                        </ul>
                    </div>
                </div>
                <div id="hostsList" style="display: none;">
                    <H3>Hosts编辑
                        <button class='btn btn-default btn-sm btn-success' onclick='editHosts()'>添加Hosts</button>
                    </H3><br>
                    <div style="max-height:402px;overflow:auto;border:#ddd 1px solid;">
                        <div class="divtable">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>IP</th>
                                        <th>域名</th>
                                        <th>操作</th>
                                    </tr>
                                </thead>
                                <tbody id="hostsFormBody">
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <ul class='help-info-text c7 mtb15'>
                        <li>当你的天空下起大雨，那是我在为你炸乌云~~~</li>
                        <li>当你的发丝微乱有阵风吹过，那是我在远处想念你~~~</li>
                    </ul>
                </div>
                <div id="softLink" style="display: none;">
                    <H3>软链接-创建</H3><br>
                    <div class='soft-man-con bt-form'><br>
                        <div class='line'><span class='tname'>源目录</span>
                            <div class='info-r'>
                                <input id='sourceDirectory' placeholder='/www/kagamine' type='text'
                                    class='bt-input-text mr5' value='' style='width: 430px;'>
                                <br />
                                <span style='color: rgb(153, 153, 153);'>请填写一个存在的目录的绝对途径，否则可能出错</span>
                            </div>
                        </div>
                        <div class='line'><span class='tname'>目标目录</span>
                            <div class='info-r'>
                                <input id='softSourceDirectory' placeholder='/www/kagamine1' type='text'
                                    class='bt-input-text mr5' value='' style='width: 430px;'>
                                <br />
                                <span style='color: rgb(153, 153, 153);'>请填写一个存在的目录的绝对途径，否则可能出错</span>
                            </div>
                        </div>
                        <div class='line'>
                            <span class='tname'></span>
                            <br>
                            <div class='info-r'>
                                <button class='btn btn-success btn-sm' onclick='addSoftLink()'>添加软链接</button>
                            </div>
                        </div><br><br><br><br><br><br><br><br><br><br><br><br><br>
                        <ul class='help-info-text c7 mtb15'>
                            <li>傻笑，不是我的专长，我要沸腾全场！</li>
                            <li>人们的想法，是强烈的，所以一定可以，创造明天！</li>
                        </ul>
                    </div>
                </div>
                <div id="commandExecution" style="display: none;">
                    <H3>命令执行</H3><br><br>
                    <textarea id="bashCommand" class="txtsjs bt-input-text" placeholder="echo Vocaloid is ALIVE"
                        name="sBody" style='line-height:20px; width: 755px; height:300px;'></textarea>
                    <br><br><br><button class='btn btn-success btn-sm' id="executeCommandBTN"
                        onclick="executeCommand('commandExecution')">执行命令</button>
                    <button class='btn btn-danger btn-sm' onclick="cleanCommandBox()">清空命令</button><br>
                    <ul class='help-info-text c7 mtb15'>
                        <li>本功能可以让你不需要连接SSH也可以通过Linux命令连接服务器</li>
                        <li>本页面命令执行时间为无限，可以执行需要很长时间的命令，并且不会卡死宝塔</li>
                        <li>如果上一次运行的命令还没有执行完成就执行下一个命令，上一个命令将会被强制结束</li>
                    </ul>
                </div>
                <div id="shortURL" style="display: none;">
                    <H3>日志写入</H3><br><br>
                    <div class='line'>
                        <span class='tname'>操作类型</span>
                        <div class='info-r'>
                            <input id='logType' placeholder='维护网站' type='text' class='bt-input-text mr5' value=''
                                style='width: 200px;'>
                            <br />
                            <span style='color: rgb(153, 153, 153);'>日志的详细信息，就是安全板块，面板操作日志的“操作类型”栏目</span>
                        </div>
                    </div>
                    <div class='line'>
                        <span class='tname'>操作详情</span>
                        <div class='info-r'>
                            <input id='logDetail' placeholder='在2021/12/27月，我维护了网站' type='text'
                                class='bt-input-text mr5' value='' style='width: 430px;'>
                            <br />
                            <span style='color: rgb(153, 153, 153);'>日志的详细信息，就是安全板块，面板操作日志的“详情”栏目</span>
                        </div>
                    </div>
                    <div class='line'>
                        <span class='tname'></span>
                        <div class='info-r'>
                            <button class='btn btn-success btn-sm' id="createShortLinkBTN"
                                onclick='logWrite()'>写入面板日志</button>
                        </div>
                    </div><br><br><br><br><br><br><br><br><br><br><br>
                    <ul class='help-info-text c7 mtb15'>
                        <li>此处你可以将您对面板的操作手动写入面板日志</li>
                        <li>我本以为我不过是个旁观者 直到我感觉到如此真实的触碰</li>
                        <li>当我看到人们含泪的微笑 我便不再是个匆匆过客</li>
                        <li>如果不曾知晓生离死别的伤痛，又该将什么铭记于心</li>
                    </ul>
                </div>
                <div id="websiteStressTest" style="display: none;">
                    <H3>网站压力测试</H3><br><br>
                    <div class='line'>
                        <span class='tname'>请求数量</span>
                        <div class='info-r'>
                            <input id='numberOfRequests' placeholder='10000' type='text' class='bt-input-text mr5'
                                value='' style='width: 430px;'>
                            <br />
                            <span style='color: rgb(153, 153, 153);'>总计发送多少个请求</span>
                        </div>
                    </div>
                    <div class='line'>
                        <span class='tname'>并发数量</span>
                        <div class='info-r'>
                            <input id='concurrentNumber' placeholder='50' type='text' class='bt-input-text mr5' value=''
                                style='width: 430px;'>
                            <br />
                            <span style='color: rgb(153, 153, 153);'>建议不要太大，一般普通博客并发并发不会超过50</span>
                        </div>
                    </div>
                    <div class='line'>
                        <span class='tname'>网页地址</span>
                        <div class='info-r'>
                            <input id='stressTestURL' placeholder='https://kagamine.top' type='text'
                                class='bt-input-text mr5' value='' style='width: 430px;'>
                            <br />
                            <span style='color: rgb(153, 153, 153);'>服务器压测不仅会对目标网站造成较大压力，也会给本服务器造成压力</span>
                        </div>
                    </div>
                    <br>
                    <div class='line'>
                        <span class='tname'></span>
                        <div class='info-r'>
                            <button class='btn btn-danger btn-sm' id="startWebsiteStressTestBTN"
                                onclick='startWebsiteStressTest()'>开始压测</button>
                        </div>
                    </div><br><br><br><br><br><br><br>
                    <ul class='help-info-text c7 mtb15'>
                        <li>注意：启动本功能后，如果使用“命令执行”功能，将会导致压测停止</li>
                        <li>可爱是天使的声音，是一次就无法忘记，是红色跳动的精灵，是每天都关禁闭</li>
                        <li>蒙德城最可爱的萝莉 —— 可莉；璃月风神 —— 七七</li>
                    </ul>
                </div>
                <div id="requestPage" style="display: none;">
                    <H3>请求网页</H3><br><br>
                    <textarea id="requestPageResult" readonly="" class="txtsjs bt-input-text" name="sBody"
                        style="line-height:20px;margin: 0px;width: 760px; height:310px;background-color: #333;color:#fff; padding:0 5px">HTTP状态码:200&#10;页面打开耗时:12.27ms&#10;页面HTML内容:&#10;<html>&#10;<head>&#10;    <title>Kagamine</title>&#10;    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">&#10;    <meta name="keywords" content="镜音双子,Kagamine,镜音连,镜音铃" />&#10;    <meta name="description" content="这个页面是个示例页面" />&#10;</head>&#10;<body>&#10;    <p>镜面双生，最美和音</p>&#10;</body>&#10;</html>&#10;</textarea>
                    <div class='line'>
                        <span class='tname'>网页地址</span>
                        <div class='info-r'>
                            <input id='requestPageUrl' placeholder='https://www.wunote.cn' type='text'
                                class='bt-input-text mr5' value='' style='width: 400px;'>
                            <button class='btn btn-success btn-sm' id="requestPageBTN"
                                onclick="requestPage()">请求！</button>
                            <button class='btn btn-danger btn-sm' onclick="cleanRequestPageResult()">清空结果</button>
                            <br />
                            <span style='color: rgb(153, 153, 153);'>网页响应时间超过60秒将会超时报错！</span>
                        </div>
                    </div><br>
                    <ul class="help-info-text c7 mtb15">
                        <li>此处请求网页的UA为Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko)
                            Chrome/91.0.4472.124 Safari/537.36 Edg/91.0.864.70</li>
                    </ul>
                </div>
                <div id="shortURL" style="display: none;">
                    <H3>短链接生成</H3><br><br>
                    <div class='line'>
                        <span class='tname'>网页地址</span>
                        <div class='info-r'>
                            <input id='longURL' placeholder='https://kagamine.top' type='text' class='bt-input-text mr5'
                                value='' style='width: 430px;'>
                            <br />
                            <span style='color: rgb(153, 153, 153);'>此处将调用外部api进行短链生成（不由作者运营，稳定性不做保证）</span>
                        </div>
                    </div>
                    <div class='line'>
                        <span class='tname'></span>
                        <div class='info-r'>
                            <button class='btn btn-success btn-sm' id="createShortLinkBTN"
                                onclick='createShortLink()'>生成短链接</button>
                        </div>
                    </div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br>
                    <ul class='help-info-text c7 mtb15'>
                        <li>既然这是一场旅行，那就一定会有终点</li>
                        <li>我们终将重逢，但不是这里....不是现在，在旅途的终点再见吧，哥哥...</li>
                        <li>去见证一切事物的沉淀，到那时，你会理解我的...</li>
                    </ul>
                </div>
                <div id="sitemapGeneration" style="display: none;">
                    <H3>网站地图生成</H3><br><br>
                    <div style="line-height:34px">
                        <textarea id="sitemapGenerationResult" readonly=""
                            style="line-height:20px; margin: 0px; width: 760px; height:250px; background-color: #333; color:#fff; padding:0 5px"
                            name="sBody">「薪炎永燃」&#10; 为世界上所有的美好而战！</textarea>
                    </div>
                    <div class='line'><span class='tname'>最大层数</span>
                        <div class='info-r'>
                            <input id='maxNumber' placeholder='7' type='number' class='bt-input-text mr5' value=''>
                            <br />
                            <span style='color: rgb(153, 153, 153);'>最多遍历X层网页（每增加一层，请求数都会增加）</span>
                        </div>
                    </div>
                    <div class='line'><span class='tname'>网站地址</span>
                        <div class='info-r'>
                            <input id='sitemapURL' placeholder='https://www.wunote.cn' type='text'
                                class='bt-input-text mr5' value='' style='width: 430px;'>
                            <br />
                            <span style='color: rgb(153, 153, 153);'>PS：开始生成后，可能产生大量非并发的请求！</span>
                        </div>
                    </div>
                    <div class='line'>
                        <span class='tname'></span>
                        <div class='info-r'>
                            <button class='btn btn-success btn-sm' id="sitemapGenerationBTN"
                                onclick='sitemapGeneration()'>开始生成</button>
                            <button class='btn btn-success btn-sm' style="display: none;" id="downloadSitemapBTN"
                                onclick='downloadSitemap()'>下载网站地图</button>
                        </div>
                    </div>
                </div>
                <div id="aboutPlugin" style="display: none;">
                    <br>
                    <center>
                        <img id="aboutImg" style="width:300px; height:300px; border-radius:100%; overflow:hidden;"
                            src="/my_toolbox/static/about.png" alt="Unknown-O" />
                        <br><br>
                        <p style='color:Grey;font-size:20px;'>为退烧而生</p><br>
                        <p style='color:Grey;font-size:15px;'>程序版本:V1.6.0</p><br>
                        <p style='color:Grey;font-size:15px;'>作者邮箱:i@mr-wu.top</p><br><a class='btn btn-success btn-sm'
                            href='https://www.wunote.cn' target='_blank'>作者博客</a> <a class='btn btn-success btn-sm'
                            href='https://www.bt.cn/bbs/thread-52772-1-1.html' target='_blank'>论坛讨论</a>
                    </center>
                </div>
            </div>
            <div id="commandExecutionResult" style="display: none;">
                <H3>执行结果 <button class='btn btn-success btn-sm' onclick="backToPreviousPage()">返回上一个</button></H3><br>
                <textarea readonly='' id="executionResult"
                    style='margin: 0px;width: 755px;height: 425px;background-color: #333;color:#fff; padding:0 5px'></textarea>
                <ul class="help-info-text c7 mtb15">
                    <li>虽然我讨厌热热乎乎的东西，我却想要拥抱你~~</li>
                </ul>
            </div>
            <div id="hostsTemplate" style="display: none;">
                <div class="row" style="width: 420px; margin-left:7px; margin-top:10px;">
                    <div class="col-sm-12">
                        <div class="input-group">
                            <span class="input-group-addon">IP</span>
                            <input id="hostsIP" class="form-control" placeholder="1.1.1.1">
                        </div>
                    </div>
                    <div class="col-sm-12" style="margin-top: 10px">
                        <div class="input-group">
                            <span class="input-group-addon">域名</span>
                            <input id="hostsDomain" class="form-control" placeholder="www.wunote.cn">
                        </div>
                    </div>
                </div>
            </div>
            <div id="mainPage">
                <br><br>
                <center>
                    <img src="/my_toolbox/static/62270332_p1.jpg">
                    <img src="/my_toolbox/static/62270332_p0.jpg">
                </center>
                <h2 style='text-align:center;margin-top:15%;'>欢迎使用，您可以在侧边栏选择工具！</h2>
            </div>
        </div>
    </div>
    <div id="fatalError" style="display: none;">
        <br>
        <center>
            <img src="/my_toolbox/static/rin.gif">
        </center>
        <br>
    </div>
</div>
<script type="text/javascript" src="../my_toolbox/static/console-image.js"></script>
<script type="text/javascript">
    $('.layui-layer-page').css({
        'width': '900px'
    });

    $(".bt-w-menu p").click(function () {
        $("#mainPage").hide(100)
        $("#commandExecutionResult").hide(100)
        var i = $(this).index();
        $(this).addClass('bgw').siblings().removeClass('bgw')
        $(".plugin_body > div").hide(200).eq(i).show(200);
        switch (i) {
            case 1:
                getHostsList()
                break;
            case 8:
                aboutPlugin()
                break;
        }
    });

    function startWebsiteStressTest() {
        $("#bashCommand").val("ab -c " + $("#concurrentNumber").val() + " -n " + $("#numberOfRequests").val() + " " + $("#stressTestURL").val())
        executeCommand("websiteStressTest")
    }

    function sitemapGeneration() {
        if (parseInt($("#maxNumber").val()) > 8) {
            layer.msg("为减少服务器压力，不允许创建操作8层的sitemap生成任务！", {
                icon: 2
            })
            return false
        }
        if ($("#sitemapURL").val() == "" || $("#maxNumber").val() == "") {
            layer.msg("为减少服务器压力，不允许创建操作8层的sitemap生成任务！", {
                icon: 2
            })
            return false
        }
        $("#sitemapGenerationBTN").attr("disabled", true)
        $("#downloadSitemapBTN").hide(200)
        requestPlugin("sitemapGeneration", {
            url: $("#sitemapURL").val(),
            maxNumber: $("#maxNumber").val()
        }, function (rdata) {
            task_stat()
            layer.msg(rdata.msg, {
                icon: rdata.status ? 1 : 2
            })
            if (rdata.status) {
                sitemapGenerationIntervalID = setInterval(function () {
                    getSitemapGenerationResult()
                }, 3000)
                document.cookie = "sitemapGenerationIntervalID=" + sitemapGenerationIntervalID
            }

        })
    }

    function getSitemapGenerationResult() {
        requestPlugin("getSitemapGenerationStatus", "", function (rdata) {
            if (rdata.status) {
                $("#sitemapGenerationBTN").attr("disabled", false)
                clearInterval(parseInt(getCookie('sitemapGenerationIntervalID')))
                delCookie('sitemapGenerationIntervalID')
                $("#sitemapGenerationResult").val(rdata.data)
                $("#downloadSitemapBTN").show(200)
            } else {
                var index = layer.msg('正在处理中，请耐心等待！', {
                    icon: 16,
                    time: 0
                });
            }
        })
    }

    function downloadSitemap() {
        window.open("/my_toolbox/static/sitemap.xml?kagamine=" + randomNumBoth(100000000000, 999999999999), "_blank");
    }

    function startScan() {
        if ($("#serverIp").val() == "" || $("#portStart").val() == "" || $("#portEnd").val() == "") {
            layer.msg("抱歉，输入的值存在错误", {
                icon: 2
            })
            return false
        }
        $("#startScanBTN").attr("disabled", true)
        requestPlugin("startScanPort", {
            serverIp: $("#serverIp").val(),
            portStart: $("#portStart").val(),
            portEnd: $("#portEnd").val()
        }, function (rdata) {
            task_stat()
            layer.msg(rdata.msg, {
                icon: rdata.status ? 1 : 2
            })
            if (rdata.status) {
                scanIntervalID = setInterval(function () {
                    getScanResult()
                }, 3000)
                document.cookie = "scanIntervalID=" + scanIntervalID
            }

        })
    }

    function backToScan() {
        $("#portFormBody").empty()
        $("#portScanResultTable").hide(200, function () {
            $("#scanPortForm").show(200)
        })
    }

    function backToPreviousPage(type) {
        $("#executionResult").val("")
        switch ($("#commandExecutionResult").attr("from")) {
            case "commandExecution":
                $("#commandExecutionResult").hide(200, function () {
                    $("#commandExecution").show(200)
                })
                break;
            case "websiteStressTest":
                $("#commandExecutionResult").hide(200, function () {
                    $("#websiteStressTest").show(200)
                })
                break
            default:
                break;
        }
    }

    function getScanResult() {
        requestPlugin("getScanResult", "", function (rdata) {
            if (rdata.status) {
                $("#startScanBTN").attr("disabled", false)
                clearInterval(parseInt(getCookie('scanIntervalID')))
                delCookie('scanIntervalID')
                $("#portFormBody").empty()
                if (rdata.data.length > 0) {
                    for (var i = 0, l = rdata.data.length; i < l; i++) {
                        var $trTemp = $("<tr></tr>")
                        $trTemp.append("<td>" + rdata.data[i].port + "</td>")
                        $trTemp.append("<td>" + rdata.data[i].status + "</td>")
                        $trTemp.append("<td>" + rdata.data[i].type + "</td>")
                        $("#portFormBody").append($trTemp);
                    }
                    $("#scanPortForm").hide(200, function () {
                        $("#portScanResultTable").show(200)
                    })
                } else {
                    layer.msg("没有任何开放端口", {
                        icon: 2
                    })
                }
            } else {
                var index = layer.msg('正在扫描中，请耐心等待！', {
                    icon: 16,
                    time: 0
                });
            }
        })
    }

    function randomNumBoth(Min, Max) {
        var Range = Max - Min;
        var Rand = Math.random();
        var num = Min + Math.round(Rand * Range);
        return num;
    }

    function getCookie(name) {
        var arr, reg = new RegExp("(^| )" + name + "=([^;]*)(;|$)");
        if (arr = document.cookie.match(reg))
            return unescape(arr[2]);
        else
            return null;
    }

    function delCookie(name) {
        var exp = new Date();
        exp.setTime(exp.getTime() - 1);
        var cval = getCookie(name);
        if (cval != null)
            document.cookie = name + "=" + cval + ";expires=" + exp.toGMTString();
    }

    function getHostsList() {
        requestPlugin("getHostsList", "", function (rdata) {
            if (rdata.status) {
                $("#hostsFormBody").empty()
                if (rdata.data.length > 0) {
                    for (var i = 0, l = rdata.data.length; i < l; i++) {
                        var $trTemp = $("<tr></tr>")
                        $trTemp.append("<td>" + rdata.data[i].ip + "</td>")
                        $trTemp.append("<td>" + rdata.data[i].domain + "</td>")
                        $trTemp.append("<td><button class='btn btn-success btn-sm' onclick='editHosts(\"" + rdata.data[i].ip + "\",\"" + rdata.data[i].domain + "\",\"" + rdata.data[i].original + "\")'>修改</button> <button class='btn btn-danger btn-sm' onclick='deleteHosts(\"" + rdata.data[i].original + "\")'>删除</button></td>")
                        $("#hostsFormBody").append($trTemp);
                    }
                }
            } else {
                layer.msg(rdata.msg, {
                    icon: rdata.status ? 1 : 2
                })
            }
        })
    }

    function editHosts(ip, domain, original) {
        layer.open({
            id: 1,
            type: 1,
            title: 'Hosts编辑',
            skin: 'layui-layer-rim',
            area: ['450px', 'auto'],
            content: $("#hostsTemplate").html().replaceAll("hosts", "temp"),
            btn: ['保存', '取消'],
            btn1: function (index, layero) {
                if (original != undefined) {
                    requestPlugin("delHosts", {
                        original: original
                    }, function (rdata) {
                        getHostsList()
                        layer.msg(rdata.msg, {
                            icon: rdata.status ? 1 : 2
                        })
                    })
                }
                requestPlugin("addHosts", {
                    ip: $("#tempIP").val(),
                    domain: $("#tempDomain").val()
                }, function (rdata) {
                    getHostsList()
                    layer.msg(rdata.msg, {
                        icon: rdata.status ? 1 : 2
                    })
                })
                layer.close(index);
            },
            btn2: function (index, layero) {
                layer.close(index);
            }
        });
        $("#tempIP").val(ip)
        $("#tempDomain").val(domain)
    }

    function deleteHosts(original) {
        requestPlugin("delHosts", {
            original: original
        }, function (rdata) {
            getHostsList()
            layer.msg(rdata.msg, {
                icon: rdata.status ? 1 : 2
            })
        })
    }

    function addSoftLink() {
        requestPlugin("addSoftLink", {
            source: $("#sourceDirectory").val(),
            softSource: $("#softSourceDirectory").val()
        }, function (rdata) {
            getHostsList()
            layer.msg(rdata.msg, {
                icon: rdata.status ? 1 : 2
            })
        })
    }

    function executeCommand(type) {
        if ($("#bashCommand").val() == "") {
            $("#bashCommand").val("echo Vocaloid is ALIVE")
        }
        $("#executeCommandBTN").attr("disabled", true)
        $("#startWebsiteStressTestBTN").attr("disabled", true)
        requestPlugin("executeCommand", {
            bashCommand: $("#bashCommand").val()
        }, function (rdata) {
            task_stat()
            layer.msg(rdata.msg, {
                icon: rdata.status ? 1 : 2
            })
            if (rdata.status) {
                executeCommandIntervalID = setInterval(function () {
                    getExecuteResult(type, rdata.logFileName)
                }, 3000)
                document.cookie = "executeCommandIntervalID=" + executeCommandIntervalID
            }
        })
        $("#bashCommand").val("")
    }

    function getExecuteResult(type, logFileName) {
        requestPlugin("getExecuteResult", { logFileName: logFileName }, function (rdata) {
            if (rdata.status) {
                if (rdata.status == 1) {
                    $("#executeCommandBTN").attr("disabled", false)
                    $("#startWebsiteStressTestBTN").attr("disabled", false)
                    $("#commandExecutionResult").attr("from", type);
                    $("#executionResult").val(rdata.result)
                    switch (type) {
                        case "commandExecution":
                            $("#commandExecution").hide(200, function () {
                                $("#commandExecutionResult").show(200)
                            })
                            break;
                        case "websiteStressTest":
                            $("#websiteStressTest").hide(200, function () {
                                $("#commandExecutionResult").show(200)
                            })
                            break
                        default:
                            break;
                    }

                }
                layer.msg(rdata.msg, {
                    icon: rdata.status ? 1 : 2
                })
                clearInterval(parseInt(getCookie('executeCommandIntervalID')))
                delCookie('executeCommandIntervalID')
            } else {
                var index = layer.msg('正在执行命令中，请耐心等待！', {
                    icon: 16,
                    time: 0
                });
            }
        })
    }

    function cleanCommandBox() {
        $("#bashCommand").val("")
    }

    function requestPage() {
        $("#requestPageBTN").attr("disabled", true)
        requestPlugin("requestPage", {
            url: $("#requestPageUrl").val()
        }, function (rdata) {
            $("#requestPageBTN").attr("disabled", false)
            if (rdata.status) {
                $("#requestPageResult").val(rdata.data)
            } else {
                layer.msg(rdata.msg, {
                    icon: rdata.status ? 1 : 2
                })
            }
        })
    }

    function cleanRequestPageResult() {
        $("#requestPageResult").val("")
        $("#requestPageUrl").val("")
    }

    function createShortLink() {
        $("#createShortLinkBTN").attr("disabled", true)
        requestPlugin("createShortLink", {
            url: $("#longURL").val()
        }, function (rdata) {
            $("#createShortLinkBTN").attr("disabled", false)
            if (rdata.status) {
                $("#longURL").val("")
                layer.open({
                    id: 1,
                    title: '生成结果',
                    content: '您的短链接: ' + rdata.result,
                    btn: ['OK！'],
                    btn1: function (index, layero) {
                        layer.close(index);
                    }
                })
            } else {
                layer.msg(rdata.msg, {
                    icon: rdata.status ? 1 : 2
                })
            }
        })
    }

    function aboutPlugin() {
        requestPlugin('displayOnce', {
            item: 'fiveStar'
        }, function (rdata) {
            if (rdata.result) {
                layer.open({
                    id: 1,
                    title: '给个五星呗~~~',
                    content: '<center><img style="border-radius:16%; overflow:hidden;" src="/my_toolbox/static/rin.gif"><br><br><p style="color:Grey;font-size:15px;">23333，给个五星呗！</p></center>',
                    btn: ['OK！'],
                    btn1: function (index, layero) {
                        pluginEgg()
                        layer.close(index);
                    }
                });
            } else {
                pluginEgg()
            }
        })
    }

    function pluginEgg() {
        var img = new Image();
        img.src = '/my_toolbox/static/78530939_p1.png'
        img.onerror = function () {
            console.log('Image loading failed')
            return false;
        };
        img.onload = function () {
            setTimeout(function () {
                $("#aboutImg").attr('src', '/my_toolbox/static/78530939_p1.png')
            }, 1500);
            setTimeout(function () {
                $("#aboutImg").attr('src', '/my_toolbox/static/about.png')
            }, 1600);
            setTimeout(function () {
                $("#aboutImg").attr('src', '/my_toolbox/static/78530939_p1.png')
            }, 1670);
            setTimeout(function () {
                layer.msg('Kagamine Yes！', {
                    icon: 1
                })
            }, 1670);
        }
    }

    function requestPlugin(function_name, args, callback, timeout) {
        var index = layer.msg('正在处理,请稍后...', {
            icon: 16,
            time: 0
        })
        plugin_name = 'my_toolbox'
        if (!timeout) timeout = 3600;
        $.ajax({
            type: 'POST',
            url: '/plugin?action=a&s=' + function_name + '&name=' + plugin_name,
            data: args,
            timeout: timeout,
            async: true,
            success: function (rdata) {
                layer.close(index)
                if (rdata.status) {
                    if (rdata.status == -1) {
                        rdata.status = 0
                    }
                    if (callback) {
                        return callback(rdata)
                    } else {
                        setTimeout(function () {
                            layer.msg(rdata.msg, {
                                icon: rdata.status ? 1 : 2
                            })
                        }, 10)
                        return true
                    }
                } else {
                    $("#pluginMain").hide(200)
                    $("#fatalError").show(100)
                    $('.layui-layer-page').css({
                        'width': '300px'
                    });
                    layer.msg(rdata.msg, {
                        icon: 2
                    })
                }
            },
            error: function (ex) {
                layer.close(index)
                if (!callback) {
                    layer.msg('请求过程发现错误!', {
                        icon: 2
                    });
                    return;
                }
                return callback(ex);
            }
        });
    }
</script>